#include <iostream>
#include <fstream>
#include <string>
#include <cmath>
#include <random>

using namespace std;

int main(int argc, char** argv)
{
  bool runProgram = true;

  // Allows the program to continously run until the user chooses to exit
  while(runProgram)
  {
    // Prompt the user to enter the name of a file
    string fileName = "";
    cout << "Please Enter The Name Of A File: " << endl;
    cin >> fileName;

    //Open the text file
    ifstream inFile;
    inFile.open(fileName);

    // Check if the file does not open properly
    if(inFile.fail())
    {
      cerr << "Error Opening File" << endl;
      exit(1);
    }

    string dnaString;

    float sumOfDNA = 0.0;

    float count = 0.0;
    float meanLength = 0.0;

    float maxLength = 0.0;
    float tempMax = 0.0;
    float tempSum = 0.0;
    float variance = 0.0;
    float standardDeviation = 0.0;

    int numA = 0;
    int numC = 0;
    int numG = 0;
    int numT = 0;

    float probA = 0.0;
    float probC = 0.0;
    float probG = 0.0;
    float probT = 0.0;

    float probAA = 0.0;
    float probAC = 0.0;
    float probAT = 0.0;
    float probAG = 0.0;
    float probCA = 0.0;
    float probCC = 0.0;
    float probCT = 0.0;
    float probCG = 0.0;
    float probTA = 0.0;
    float probTC = 0.0;
    float probTT = 0.0;
    float probTG = 0.0;
    float probGA = 0.0;
    float probGC = 0.0;
    float probGT = 0.0;
    float probGG = 0.0;


    // Read in every value from the file until the end
    // eof --> end of file
    while(!inFile.eof())
    {
        inFile >> dnaString;

        tempMax = dnaString.length();

        if(tempMax > maxLength)
          maxLength = tempMax;

        sumOfDNA = sumOfDNA + dnaString.length();
        count++;

        meanLength = sumOfDNA / count;

        // tempSum used to calculate variance
        tempSum += pow((dnaString.length() - meanLength), 2);

        // Calculates the number of each letter for each line in the input text file
        for(int i = 0; i < dnaString.length(); ++i)
        {

          if(dnaString[i] == 'A')
          {
            numA++;
          }

          else if(dnaString[i] == 'C')
          {
            numC++;
          }

          else if(dnaString[i] == 'G')
          {
            numG++;
          }

          else if(dnaString[i] == 'T')
          {
            numT++;
          }

        }

    }

    // Calculates the probability of each letter and nucleotide
    probA = numA / sumOfDNA;
    probC = numC / sumOfDNA;
    probG = numG / sumOfDNA;
    probT = numT / sumOfDNA;

    probAA = probA * probA;
    probAC = probA * probC;
    probAT = probA * probT;
    probAG = probA * probG;

    probCA = probC * probA;
    probCC = probC * probC;
    probCT = probC * probT;
    probCG = probC * probG;

    probTA = probT * probA;
    probTC = probT * probC;
    probTT = probT * probT;
    probTG = probT * probG;

    probGA = probG * probA;
    probGC = probG * probC;
    probGT = probG * probT;
    probGG = probG * probG;

    // Calculate variance
    variance = tempSum / count - 1;
    variance = variance * -1;

    // Calculate standard deviation
    standardDeviation = sqrt(variance);

    // Open the output text file
    ofstream outputFile;
    outputFile.open("jeremyanderson.txt");

    outputFile << "Jeremy Anderson" << endl;
    outputFile << "Student ID: 2314466" << endl;
    outputFile << "" << endl;
    outputFile << "" << endl;
    outputFile << "The Sum Of The Length Of The DNA Strings Is: " << sumOfDNA << endl;
    outputFile << "The Mean Length Of The DNA Strings Is: " << meanLength << endl;
    outputFile << "The Variance Of The Length Of The DNA Strings Is: " << variance << endl;
    outputFile << "The Standard Deviation Of The Length Of The DNA Strings Is: " << standardDeviation << endl;
    outputFile << "" << endl;
    outputFile << "Relative Probability of A: " << probA << endl;
    outputFile << "Relative Probability of C: " << probC << endl;
    outputFile << "Relative Probability of G: " << probG << endl;
    outputFile << "Relative Probability of T: " << probT << endl;
    outputFile << "" << endl;
    outputFile << "Relative Probability of AA: " << probAA << endl;
    outputFile << "Relative Probability of AC: " << probAC << endl;
    outputFile << "Relative Probability of AT: " << probAT << endl;
    outputFile << "Relative Probability of AG: " << probAG << endl;
    outputFile << "Relative Probability of CA: " << probCA << endl;
    outputFile << "Relative Probability of CC: " << probCC << endl;
    outputFile << "Relative Probability of CT: " << probCT << endl;
    outputFile << "Relative Probability of CG: " << probCG << endl;
    outputFile << "Relative Probability of TA: " << probTA << endl;
    outputFile << "Relative Probability of TC: " << probTC << endl;
    outputFile << "Relative Probability of TT: " << probTT << endl;
    outputFile << "Relative Probability of TG: " << probTG << endl;
    outputFile << "Relative Probability of GA: " << probGA << endl;
    outputFile << "Relative Probability of GC: " << probGC << endl;
    outputFile << "Relative Probability of GT: " << probGT << endl;
    outputFile << "Relative Probability of GG: " << probGG << endl;

    int nucA = 0;
    int nucC = 0;
    int nucG = 0;
    int nucT = 0;


    outputFile << "" << endl;
    outputFile << "1000 DNA Strings Based On Calculated Statistics: " << endl;
    outputFile << "" << endl;

    string generatedDNAString = "";

    // Iterates 1000 times for 1000 DNA strings
    for(int i = 0; i < 1000; ++i)
    {
        // Calculates the length of each DNA string based on previous statistics
        float a = (float) rand() / RAND_MAX;
        float b = (float) rand() / RAND_MAX;
        float c = sqrt(-2 * log(a)) * cos(2 * M_PI * b);
        int d = standardDeviation * c + meanLength;

        // Calculates the number of As, Cs, Gs, and Ts
        nucA = numA / sumOfDNA * d;
        nucC = numC / sumOfDNA * d;
        nucG = numG / sumOfDNA * d;
        nucT = numT / sumOfDNA * d;

        // Generates a string for each iteration
        for(int j = 0; j < nucA; j++)
        {
          generatedDNAString += 'A';
        }

        for(int j = 0; j < nucC; j++)
        {
          generatedDNAString += 'C';
        }

        for(int j = 0; j < nucG; j++)
        {
          generatedDNAString += 'G';
        }

        for(int j = 0; j < nucT; j++)
        {
          generatedDNAString += 'T';
        }
        outputFile << generatedDNAString << endl;

        generatedDNAString = "";

    }


    outputFile << generatedDNAString << endl;

    // Close both files
    inFile.close();
    outputFile.close();

    cout << "" << endl;
    cout << "Do You Want To Process Another List?" << endl;
    cout << "Enter Y for Yes" << endl;
    cout << "Enter N for No" << endl;
    string response = "";

    cin >> response;

    // Restarts the program if user responds yes
    if(response == "Y")
    {
      runProgram = true;
    }

    // Restarts the program if user responds yes
    else if(response == "y")
    {
      runProgram = true;
    }

    // Exits the program
    else if(response == "N")
    {
      runProgram = false;
      cout << "You Have Exited The Program";
      break;
    }

    // Exits the program
    else if(response == "n")
    {
      runProgram = false;
      cout << "You Have Exited The Program";
      break;
    }
  }
  return 0;
}
